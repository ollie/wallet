// Generated by CoffeeScript 2.5.1
(function() {
  this.TagsSort = class TagsSort {
    constructor() {
      var $tags, tagsHtml;
      $tags = $('.js-tags-sort');
      if (!$tags.length) {
        return;
      }
      tagsHtml = $tags.html();
      $tags.sortable({
        axis: 'y',
        containment: 'parent',
        handle: '.js-sortable-handle',
        tolerance: 'pointer',
        update: function() {
          var changes;
          changes = {};
          $tags.find('li').each(function(i) {
            var $tag, newPosition, oldPosition;
            newPosition = i + 1;
            $tag = $(this);
            oldPosition = $tag.data('position');
            if (newPosition === oldPosition) {
              return;
            }
            $tag.attr('data-position', newPosition);
            return changes[$tag.data('id')] = newPosition;
          });
          if ($.isEmptyObject(changes)) {
            return;
          }
          return $.ajax($tags.data('path'), {
            method: 'POST',
            data: {
              positions: changes
            },
            error: function() {
              return $tags.html(tagsHtml);
            },
            success: function() {
              return tagsHtml = $tags.html();
            }
          });
        }
      });
    }

  };

}).call(this);
