// Generated by CoffeeScript 2.5.1
(function() {
  this.RecurringEntriesChart = class RecurringEntriesChart {
    constructor() {
      this.element = $('#recurring-entries-chart');
      if (!this.element.length) {
        return;
      }
      HighchartsConfig.init();
      this.init();
    }

    init() {
      return $.getJSON(this.element.data('url'), (data) => {
        var balance, categories, expenses, item, month, options, predictedBalance, remainder, series;
        categories = [];
        series = {
          expenses: {
            name: 'Výdaje',
            color: '#C73C35',
            stacking: 'normal',
            index: 2,
            data: []
          },
          remainder: {
            name: 'Polštář',
            color: '#108A00',
            stacking: 'normal',
            index: 1,
            data: []
          },
          predictedBalance: {
            type: 'line',
            yAxis: 1,
            name: 'Odhad bilance',
            color: '#fedd44',
            index: 3,
            lineWidth: 4,
            marker: {
              symbol: 'circle',
              lineWidth: 4,
              radius: 6,
              lineColor: '#fedd44',
              fillColor: 'white'
            },
            data: []
          },
          balance: {
            type: 'line',
            yAxis: 1,
            name: 'Bilance',
            color: '#7cb5ec',
            index: 4,
            lineWidth: 4,
            marker: {
              symbol: 'circle',
              lineWidth: 4,
              radius: 6,
              lineColor: '#7cb5ec',
              fillColor: 'white'
            },
            data: []
          }
        };
        for (month in data) {
          item = data[month];
          categories.push(month);
          expenses = Number(item.expenses);
          remainder = Number(item.remainder);
          predictedBalance = item.predicted_balance === null ? false : Number(item.predicted_balance);
          balance = item.balance === null ? false : Number(item.balance);
          series.expenses.data.push(expenses);
          series.remainder.data.push(remainder);
          series.predictedBalance.data.push(predictedBalance);
          series.balance.data.push(balance);
        }
        options = {
          chart: {
            type: 'column',
            height: 500,
            spacing: [5, 0, 5, 0]
          },
          title: null,
          xAxis: {
            categories: categories
          },
          yAxis: [
            {
              title: null
            },
            {
              title: null,
              opposite: true
            }
          ],
          tooltip: {
            pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y} Kč</b><br/>',
            shared: true
          },
          // plotOptions:
          //   series:
          //     stacking: 'normal'
          legend: {
            enabled: false
          },
          series: [series.expenses, series.remainder, series.predictedBalance, series.balance],
          credits: {
            enabled: false
          }
        };
        return Highcharts.chart(this.element.attr('id'), options);
      });
    }

  };

}).call(this);
