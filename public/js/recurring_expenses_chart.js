// Generated by CoffeeScript 2.5.0
(function() {
  this.RecurringExpensesChart = class RecurringExpensesChart {
    constructor() {
      this.element = $('#recurring-expenses-chart');
      if (!this.element.length) {
        return;
      }
      HighchartsConfig.init();
      this.init();
    }

    init() {
      return $.getJSON(this.element.data('url'), (data) => {
        var date, expenses, i, item, len, options, plotLineTimestamp, plotLines, previous_period_expenses, series, timestamp, year, yearTmp;
        series = {
          previous_period_expenses: {
            name: 'Výdaje minulý rok',
            showInNavigator: true,
            color: '#cccccc',
            type: 'column',
            index: 2,
            data: []
          },
          expenses: {
            name: 'Výdaje',
            showInNavigator: true,
            color: '#C73C35',
            type: 'column',
            index: 3,
            data: []
          }
        };
        plotLines = [];
        yearTmp = null;
        for (i = 0, len = data.length; i < len; i++) {
          item = data[i];
          date = new Date(item.date);
          year = date.getFullYear();
          if (yearTmp == null) {
            yearTmp = year;
          }
          timestamp = date.getTime();
          previous_period_expenses = Number(item.previous_period_expenses);
          expenses = Number(item.expenses);
          if (year !== yearTmp) {
            plotLineTimestamp = Date.UTC(year, 0, 1);
            plotLines.push(this._createPlotLine(plotLineTimestamp, year));
            yearTmp = year;
          }
          series.previous_period_expenses.data.push([timestamp, previous_period_expenses]);
          series.expenses.data.push([timestamp, expenses]);
        }
        options = {
          chart: {
            height: 500,
            spacing: [5, 0, 5, 0]
          },
          type: 'line',
          xAxis: {
            plotLines: plotLines
          },
          series: [series.previous_period_expenses, series.expenses],
          // plotOptions:
          //   series:
          //     animation: 500
          rangeSelector: {
            buttons: [
              {
                type: 'year',
                count: 1,
                text: 'Rok'
              },
              {
                type: 'all',
                text: 'Vše'
              }
            ],
            selected: 0,
            inputBoxWidth: 100,
            inputDateFormat: '%B %Y',
            inputEditDateFormat: '%d. %m. %Y'
          },
          credits: {
            enabled: false
          }
        };
        return Highcharts.stockChart(this.element.attr('id'), options);
      });
    }

    _createPlotLine(value, text) {
      return {
        color: '#e6e6e6',
        value: value,
        width: 1,
        label: {
          text: text,
          style: {
            color: '#cccccc'
          }
        }
      };
    }

  };

}).call(this);
