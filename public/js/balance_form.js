// Generated by CoffeeScript 2.5.1
(function() {
  this.BalanceForm = class BalanceForm {
    constructor() {
      this._handleSumButtonClick = this._handleSumButtonClick.bind(this);
      this.balanceAmountInput = $('#balance-amount');
      if (!this.balanceAmountInput.length) {
        return;
      }
      this.noteArea = $('#balance-note');
      this.sumButton = $('.js-bilances-sum');
      this.sumButton.on('click', this._handleSumButtonClick);
    }

    _handleSumButtonClick(e) {
      var i, len, lines, number, numbers, sum, text;
      e.preventDefault();
      text = this.noteArea.val();
      lines = text.split(/\s*\n\s*/);
      numbers = [];
      lines.forEach(function(line) {
        var match, number, numberAsString;
        line = line.replace(/\s/g, '');
        match = line.match(/\b\d+([,\.]\d+)?\b/);
        if (!match) {
          console.warn(`Cannot find number in line: ${line}`);
          return;
        }
        numberAsString = match[0];
        numberAsString = numberAsString.replace(',', '.');
        number = Number(numberAsString);
        if (isNaN(number)) {
          console.warn(`Could not convert to number: ${numberAsString} (line: ${line})`);
          return;
        }
        return numbers.push(number);
      });
      sum = 0;
      for (i = 0, len = numbers.length; i < len; i++) {
        number = numbers[i];
        sum += number;
      }
      sum = Math.round(sum * 100) / 100;
      return this.balanceAmountInput.val(sum).focus();
    }

  };

}).call(this);
