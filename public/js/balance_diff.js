// Generated by CoffeeScript 2.5.1
(function() {
  this.BalanceDiff = class BalanceDiff {
    constructor() {
      this._handleClick = this._handleClick.bind(this);
      this.elements = $('.js-balance-diff');
      if (!this.elements.length) {
        return;
      }
      this.diff = $('#balance-diff');
      this.items = [];
      this.elements.on('click', this._handleClick);
    }

    _handleClick(e) {
      var $input, amount, date, item;
      $input = $(e.currentTarget);
      if (!$input.is(':checked')) {
        this._removeItem($input);
        return;
      }
      date = Date.parse($input.data('date'));
      amount = Number($input.val());
      item = {
        input: $input,
        amount: amount,
        date: date
      };
      this._addItem(item);
      return this._calculate();
    }

    _addItem(item) {
      var i, j, len, ref;
      switch (this.items.length) {
        case 0:
          return this.items.push(item);
        case 1:
          if (item.date > this.items[0].date) {
            return this.items.unshift(item);
          } else {
            return this.items.push(item);
          }
          break;
        default:
          ref = this.items;
          for (j = 0, len = ref.length; j < len; j++) {
            i = ref[j];
            i.input.prop('checked', false);
          }
          this.items = [];
          return this.items.push(item);
      }
    }

    _removeItem($input) {
      var item, j, len, ref;
      ref = this.items;
      for (j = 0, len = ref.length; j < len; j++) {
        item = ref[j];
        item.input.prop('checked', false);
      }
      this.items = [];
      return $input.trigger('click');
    }

    _calculate() {
      var diff, parts, textDiff;
      if (this.items.length < 2) {
        this.diff.text('');
        return;
      }
      diff = this.items[0].amount - this.items[1].amount;
      parts = parseFloat(diff).toFixed(2).split('.');
      parts[0] = parts[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g, '$1 ');
      textDiff = `${parts.join(',')} KÄ`;
      if (diff >= 0) {
        textDiff = `+${textDiff}`;
      }
      return this.diff.text(textDiff);
    }

  };

}).call(this);
